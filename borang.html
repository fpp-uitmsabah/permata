<!doctype html>
<html lang="ms">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Borang Maklum Balas Semakan Kurikulum</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  
  <style>
    /* --- 1. CSS UTAMA (TAMPILAN WEB) --- */
    body { box-sizing: border-box; margin: 0; padding: 0; height: 100%; overflow-y: auto; background: #f3f4f6; }
    .header-image { width: 100%; height: auto; max-height: 300px; object-fit: contain; display: block; background: white; }
    .form-container { max-width: 900px; margin: 1rem auto 2rem; position: relative; z-index: 10; padding: 0 1rem; }
    
    /* Card Style */
    .section { background: white; border-radius: 12px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
    .section-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 1.5rem; padding-bottom: 0.75rem; border-bottom: 3px solid #2563eb; color: #1f2937; }
    
    /* Inputs */
    .input-field { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.95rem; margin-top: 0.25rem; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .input-field:focus { outline: none; ring: 2px; ring-color: #2563eb; border-color: #2563eb; }
    textarea.input-field { min-height: 120px; resize: vertical; }
    
    .label { display: block; font-weight: 600; margin-top: 1rem; color: #1f2937; }
    .description-text { font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem; margin-top: 0.2rem; font-style: italic; }
    
    .submit-btn { background: #2563eb; color: white; padding: 1rem 3rem; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; width: 100%; margin-top: 2rem; transition: background 0.2s; }
    .submit-btn:hover { background: #1d4ed8; }
    
    .info-table { width: 100%; border-collapse: separate; border-spacing: 0; }
    .info-table td { padding: 0.75rem; border-bottom: 1px solid #e5e7eb; }
    .info-table td:first-child { font-weight: 600; width: 35%; color: #4b5563; background: #f9fafb; }

    /* --- 2. MODAL PREVIEW --- */
    .pdf-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; z-index: 2000; justify-content: center; align-items: center; padding: 1rem; }
    .pdf-modal.active { display: flex; }
    .pdf-modal-content { background: #525659; width: 100%; max-width: 1000px; height: 90vh; border-radius: 8px; display: flex; flex-direction: column; overflow: hidden; }
    .pdf-preview-scroller { flex: 1; overflow-y: auto; padding: 2rem; display: flex; justify-content: center; background: #525659; }
    .pdf-preview-page { background: white; width: 210mm; min-height: 297mm; padding: 0; box-shadow: 0 0 15px rgba(0,0,0,0.5); }

    /* --- 3. PDF STRUKTUR --- */
    .pdf-structure { font-family: "Times New Roman", Times, serif; font-size: 12pt; color: #000; line-height: 1.5; }
    
    /* PENTING: Header Container */
    .pdf-header-container { 
        width: 100%; 
        line-height: 0; 
        margin-bottom: 20px;
        /* Trik untuk tarik imej masuk ke dalam margin atas di Page 1 sahaja */
        margin-top: -25mm; 
    }
    .pdf-header-img { width: 100%; height: auto; max-height: 150px; object-fit: cover; }
    
    /* Body Content - Margin Kiri Kanan sahaja (Atas Bawah dikawal oleh @page) */
    .pdf-body { 
        padding: 0 25mm; /* Kiri Kanan 25mm */
        text-align: justify; 
    }
    
    .pdf-doc-title { text-align: center; font-weight: bold; font-size: 14pt; margin-bottom: 5px; text-transform: uppercase; text-decoration: underline; margin-top: 10px; }
    .pdf-doc-subtitle { text-align: center; font-size: 11pt; font-style: italic; margin-bottom: 25px; }
    
    .pdf-section-block { margin-bottom: 20px; break-inside: auto; }
    .pdf-sec-title { font-weight: bold; font-size: 12pt; margin-bottom: 10px; text-transform: uppercase; padding-top: 10px; border-bottom: 1px solid #000; display: inline-block; width: 100%; }
    
    .pdf-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 11pt; }
    .pdf-table td { border: 1px solid #000; padding: 6px 8px; vertical-align: top; }
    .pdf-table td:first-child { width: 35%; background-color: #f0f0f0 !important; font-weight: bold; -webkit-print-color-adjust: exact; }
    
    .pdf-item { margin-bottom: 15px; break-inside: auto; }
    .pdf-question { font-weight: bold; margin-bottom: 5px; display: block; }
    .pdf-desc { font-style: italic; font-size: 10pt; color: #444; margin-bottom: 5px; display: block; }
    .pdf-answer { display: block; border: 1px solid #000; padding: 8px; min-height: 24px; white-space: pre-wrap; text-align: left; background: #fafafa; -webkit-print-color-adjust: exact; }
    
    .pdf-sig-wrapper { margin-top: 30px; display: flex; justify-content: space-between; gap: 20px; break-inside: avoid; }
    .pdf-sig-box { width: 48%; border: 1px solid #000; padding: 15px; }
    .pdf-sig-header { text-align: center; font-weight: bold; border-bottom: 1px solid #000; padding-bottom: 5px; margin-bottom: 10px; }
    .pdf-sig-line { border-top: 1px solid #000; margin-top: 50px; padding-top: 5px; font-size: 10pt; text-align: center; font-weight: bold; }

    /* --- 4. LOGIK CETAKAN & MARGIN --- */
    #printContainer { display: none; }
    body.is-printing > * { display: none !important; }
    body.is-printing #printContainer { display: block !important; position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; }
    body.is-printing { background: white; }

    @media print {
        @page { 
            /* INI RAHSIA MARGIN "NORMAL" WORD */
            margin-top: 25mm;     /* Jarak Atas (Page 2 akan mula di sini) */
            margin-bottom: 25mm;  /* Jarak Bawah (Supaya content tak cecah lantai) */
            margin-left: 0;       /* Kiri 0 (Sebab padding body dah handle) */
            margin-right: 0;      /* Kanan 0 */
            size: A4 portrait; 
        }
        
        body > * { display: none !important; }
        #printContainer { display: block !important; }
        
        /* Footer penomboran */
        .page-footer-marker { 
            position: fixed; 
            bottom: 0; /* 0 relative to margin area */
            right: 25mm; 
            font-size: 9pt; 
            color: #555; 
            display: block !important; 
        }
        
        * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
    }
  </style>
 </head>
 <body>
  
  <div id="toast" class="toast"></div>

  <div id="webContent">
      <img src="https://i.imgur.com/AVVKZJx.jpeg" alt="Header Borang" class="header-image">

      <div class="form-container">
       <form id="feedbackForm">
        <div class="section">
         <h2 class="section-title">üìã BAHAGIAN A: MAKLUMAT KURSUS</h2>
         <div style="overflow-x:auto;">
             <table class="info-table">
               <tr><td>Nama Kursus</td><td><input type="text" name="nama_kursus" class="input-field" required></td></tr>
               <tr><td>Kod Kursus</td><td><input type="text" name="kod_kursus" class="input-field" required></td></tr>
               <tr><td>Program</td><td><input type="text" name="program" class="input-field" required></td></tr>
               <tr><td>Tarikh Semakan</td><td><input type="date" name="tarikh_semakan" class="input-field" required></td></tr>
             </table>
         </div>
        </div>

        <div class="section">
         <h2 class="section-title">üí≠ BAHAGIAN B: ULASAN DAN PENILAIAN</h2>
         <div class="field-group"><label class="label">1. Penjajaran Hasil Pembelajaran Kursus (CLO)</label><p class="description-text">Ulasan mengenai kesesuaian CLO dengan tahap pembelajaran dan pemetaan kepada Hasil Pembelajaran Program/PLO</p><textarea name="penjajaran_clo" class="input-field" required></textarea></div>
         <div class="field-group"><label class="label">2. Kandungan dan Silibus Kursus</label><p class="description-text">Komen mengenai relevansi topik, kemutakhiran silibus, dan kecukupan liputan topik</p><textarea name="kandungan_silibus" class="input-field" required></textarea></div>
         <div class="field-group"><label class="label">3. Kaedah Penilaian</label><p class="description-text">Kesesuaian pemberatan penilaian berterusan dan peperiksaan akhir serta jenis penilaian yang digunakan</p><textarea name="kaedah_penilaian" class="input-field" required></textarea></div>
         <div class="field-group"><label class="label">4. Kaedah Pengajaran dan Pembelajaran (PdP)</label><p class="description-text">Kesesuaian strategi penyampaian seperti kuliah, tutorial, amali, atau pembelajaran berasaskan masalah</p><textarea name="kaedah_pdp" class="input-field" required></textarea></div>
         <div class="field-group"><label class="label">5. Cadangan Penambahbaikan</label><p class="description-text">Saranan spesifik untuk meningkatkan kualiti kursus pada masa hadapan</p><textarea name="cadangan_penambahbaikan" class="input-field" required></textarea></div>
        </div>

        <div class="section">
         <h2 class="section-title">üîÑ BAHAGIAN C: ISU KHUSUS (PERUBAHAN NAMA PROGRAM)</h2>
         <div class="field-group"><label class="label">Adakah anda bersetuju dengan cadangan perubahan nama program ini?</label><div style="display:flex; gap:20px; margin-top:10px;"><label style="display:flex; align-items:center; gap:8px; cursor:pointer;"><input type="radio" name="perubahan_nama" value="Ya" required style="width:20px; height:20px;"> Ya</label><label style="display:flex; align-items:center; gap:8px; cursor:pointer;"><input type="radio" name="perubahan_nama" value="Tidak" required style="width:20px; height:20px;"> Tidak</label></div></div>
         <div class="field-group"><label class="label">Justifikasi:</label><p class="description-text">Sila nyatakan sebab atau cadangan alternatif sekiranya anda memilih 'Tidak'</p><textarea name="justifikasi" class="input-field" required></textarea></div>
        </div>

        <div class="section">
         <h2 class="section-title">‚úçÔ∏è BAHAGIAN D: PENGESAHAN</h2>
         <p style="font-weight: 600; margin-bottom: 1rem;">Disediakan oleh:</p>
         <div class="field-group"><label class="label">Nama Pensyarah:</label> <input type="text" name="nama_pensyarah" class="input-field" required></div>
         <div class="field-group"><label class="label">Jawatan:</label> <input type="text" class="input-field" value="Lecturer in Charge (LiC) / Penyelaras Kursus" readonly style="background: #f9fafb;"></div>
         <div class="field-group"><label class="label">Tarikh:</label> <input type="date" name="tarikh_pengesahan" class="input-field" required></div>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">üì§ Semak & Jana PDF</button>
       </form>
      </div>
  </div>

  <div id="pdfModal" class="pdf-modal">
   <div class="pdf-modal-content">
    <div class="pdf-modal-header" style="padding:1rem; background:white; border-bottom:1px solid #ddd; display:flex; justify-content:space-between; align-items:center;">
     <h3 style="font-weight:bold; color:#333; margin:0;">Pratonton Dokumen</h3>
     <button onclick="closeModal()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">‚úï</button>
    </div>
    <div class="pdf-preview-scroller">
        <div id="modalPreviewBody" class="pdf-preview-page pdf-structure"></div>
    </div>
    <div style="padding:1rem; background:white; border-top:1px solid #ddd; display:flex; justify-content:flex-end; gap:10px;">
      <button onclick="closeModal()" style="padding:0.5rem 1.5rem; border-radius:5px; border:1px solid #ccc; background:white; cursor:pointer;">Tutup</button>
      <button onclick="triggerPrint()" style="padding:0.5rem 1.5rem; border-radius:5px; border:none; background:#2563eb; color:white; font-weight:bold; cursor:pointer;">üñ®Ô∏è Simpan PDF</button>
    </div>
   </div>
  </div>

  <div id="printContainer">
    <div class="pdf-structure">
        <div class="pdf-header-container">
            <img src="https://i.imgur.com/AVVKZJx.jpeg" class="pdf-header-img" style="display:block; width:100%;">
        </div>
        
        <div class="pdf-body">
            <div class="pdf-doc-title">BORANG MAKLUM BALAS SEMAKAN KURIKULUM</div>
            <div class="pdf-doc-subtitle">(Oleh Penyelaras Kursus / Lecturer in Charge - LiC)</div>

            <div class="pdf-section-block">
                <div class="pdf-sec-title">BAHAGIAN A: MAKLUMAT KURSUS</div>
                <table class="pdf-table">
                    <tr><td>Nama Kursus</td><td id="p-nama_kursus"></td></tr>
                    <tr><td>Kod Kursus</td><td id="p-kod_kursus"></td></tr>
                    <tr><td>Program</td><td id="p-program"></td></tr>
                    <tr><td>Tarikh Semakan</td><td id="p-tarikh_semakan"></td></tr>
                </table>
            </div>

            <div class="pdf-section-block">
                <div class="pdf-sec-title">BAHAGIAN B: ULASAN DAN PENILAIAN</div>
                
                <div class="pdf-item"><span class="pdf-question">1. Penjajaran Hasil Pembelajaran Kursus (CLO)</span><span class="pdf-desc">Ulasan mengenai kesesuaian CLO dengan tahap pembelajaran dan pemetaan kepada Hasil Pembelajaran Program/PLO</span><span class="pdf-answer" id="p-penjajaran_clo"></span></div>
                <div class="pdf-item"><span class="pdf-question">2. Kandungan dan Silibus Kursus</span><span class="pdf-desc">Komen mengenai relevansi topik, kemutakhiran silibus, dan kecukupan liputan topik</span><span class="pdf-answer" id="p-kandungan_silibus"></span></div>
                <div class="pdf-item"><span class="pdf-question">3. Kaedah Penilaian</span><span class="pdf-desc">Kesesuaian pemberatan penilaian berterusan dan peperiksaan akhir serta jenis penilaian yang digunakan</span><span class="pdf-answer" id="p-kaedah_penilaian"></span></div>
                <div class="pdf-item"><span class="pdf-question">4. Kaedah Pengajaran dan Pembelajaran (PdP)</span><span class="pdf-desc">Kesesuaian strategi penyampaian seperti kuliah, tutorial, amali, atau pembelajaran berasaskan masalah</span><span class="pdf-answer" id="p-kaedah_pdp"></span></div>
                <div class="pdf-item"><span class="pdf-question">5. Cadangan Penambahbaikan</span><span class="pdf-desc">Saranan spesifik untuk meningkatkan kualiti kursus pada masa hadapan</span><span class="pdf-answer" id="p-cadangan_penambahbaikan"></span></div>
            </div>

            <div class="pdf-section-block">
                <div class="pdf-sec-title">BAHAGIAN C: ISU KHUSUS (PERUBAHAN NAMA PROGRAM)</div>
                <div class="pdf-item"><span class="pdf-question">Adakah anda bersetuju dengan cadangan perubahan nama program ini?</span><span class="pdf-answer" id="p-perubahan_nama"></span></div>
                <div class="pdf-item"><span class="pdf-question">Justifikasi:</span><span class="pdf-desc">Sila nyatakan sebab atau cadangan alternatif sekiranya anda memilih 'Tidak'</span><span class="pdf-answer" id="p-justifikasi"></span></div>
            </div>

            <div class="pdf-section-block">
                <div class="pdf-sec-title">BAHAGIAN D: PENGESAHAN</div>
                <div class="pdf-sig-wrapper">
                    <div class="pdf-sig-box">
                        <div class="pdf-sig-header">Disediakan Oleh</div>
                        <div style="margin-top:10px;">
                            <div style="margin-bottom:5px;"><strong>Nama:</strong> <span id="p-nama_pensyarah"></span></div>
                            <div style="margin-bottom:5px;"><strong>Jawatan:</strong> Lecturer in Charge (LiC)</div>
                            <div style="margin-bottom:5px;"><strong>Tarikh:</strong> <span id="p-tarikh_pengesahan"></span></div>
                        </div>
                        <div class="pdf-sig-line">Tandatangan Pensyarah Penyelaras</div>
                    </div>
                    <div class="pdf-sig-box">
                        <div class="pdf-sig-header">Disahkan Oleh</div>
                        <div style="margin-top:10px;">
                            <div style="margin-bottom:5px;"><strong>Nama:</strong> _______________________</div>
                            <div style="margin-bottom:5px;"><strong>Jawatan:</strong> Penyelaras Program (PU)</div>
                            <div style="margin-bottom:5px;"><strong>Tarikh:</strong> _______________________</div>
                        </div>
                        <div class="pdf-sig-line">Tandatangan Penyelaras PU</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="page-footer-marker">
            Dokumen Dijana Secara Digital
        </div>
    </div>
  </div>

  <script>
    function setText(id, val) {
        const el = document.getElementById(id);
        if (el) el.textContent = val || '-';
    }
    
    function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return `${date.getDate().toString().padStart(2,'0')}/${(date.getMonth()+1).toString().padStart(2,'0')}/${date.getFullYear()}`;
    }

    function showToast(msg, error=false) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.style.background = error ? '#ef4444' : '#10b981';
        t.style.display = 'block';
        setTimeout(()=>t.style.display='none', 3000);
    }

    function triggerPrint() {
        closeModal();
        document.body.classList.add('is-printing');
        setTimeout(() => {
            window.print();
            setTimeout(() => {
                document.body.classList.remove('is-printing');
            }, 1000);
        }, 100);
    }

    document.getElementById('feedbackForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const originalText = btn.textContent;
        btn.textContent = '‚è≥ Memproses...';
        btn.disabled = true;

        const formData = new FormData(e.target);

        setText('p-nama_kursus', formData.get('nama_kursus'));
        setText('p-kod_kursus', formData.get('kod_kursus'));
        setText('p-program', formData.get('program'));
        setText('p-tarikh_semakan', formatDate(formData.get('tarikh_semakan')));
        setText('p-penjajaran_clo', formData.get('penjajaran_clo'));
        setText('p-kandungan_silibus', formData.get('kandungan_silibus'));
        setText('p-kaedah_penilaian', formData.get('kaedah_penilaian'));
        setText('p-kaedah_pdp', formData.get('kaedah_pdp'));
        setText('p-cadangan_penambahbaikan', formData.get('cadangan_penambahbaikan'));
        setText('p-perubahan_nama', formData.get('perubahan_nama'));
        setText('p-justifikasi', formData.get('justifikasi'));
        setText('p-nama_pensyarah', formData.get('nama_pensyarah'));
        setText('p-tarikh_pengesahan', formatDate(formData.get('tarikh_pengesahan')));

        try {
            if(window.dataSdk) {
                await window.dataSdk.create({
                    id: Date.now().toString(),
                    nama_kursus: formData.get('nama_kursus'),
                    submitted_at: new Date().toISOString()
                });
                showToast('‚úÖ Data disimpan');
            }
        } catch(err) {
            console.log('Dev mode');
        }

        const printContent = document.getElementById('printContainer').innerHTML;
        document.getElementById('modalPreviewBody').innerHTML = printContent;
        document.getElementById('pdfModal').classList.add('active');

        btn.disabled = false;
        btn.textContent = originalText;
    });

    function closeModal() {
        document.getElementById('pdfModal').classList.remove('active');
    }
    
    if(window.dataSdk) window.dataSdk.init({onDataChanged:()=>{}});
  </script>
 </body>
</html>
