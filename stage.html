<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Directory & Portfolio Gateway</title>

    <meta property="og:title" content="Faculty Directory & Portfolio Gateway">
    <meta property="og:description" content="Discover distinguished faculty members from UiTM Sabah and explore their expertise.">
    <meta property="og:image" content="https://i.imgur.com/SEXIf1W.jpeg">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Faculty Directory & Portfolio Gateway">
    <meta name="twitter:description" content="Discover distinguished faculty members from UiTM Sabah and explore their expertise.">
    <meta name="twitter:image" content="https://i.imgur.com/SEXIf1W.jpeg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        /* Enhanced animations and transitions */
        .faculty-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .faculty-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .faculty-card:hover::before {
            left: 100%;
        }
        
        .faculty-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255,255,255,0.1);
        }
        
        .faculty-avatar {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .faculty-card:hover .faculty-avatar {
            transform: scale(1.1);
        }
        
        .field-badge {
            font-size: 0.75rem;
            padding: 0.4rem 1rem;
            border-radius: 50px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .field-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .field-badge:hover::before {
            left: 100%;
        }
        
        /* Enhanced field colors with gradients */
        .ekonomi { 
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .kewangan { 
            background: linear-gradient(135deg, #10b981, #047857);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .pemasaran { 
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        .pengurusan { 
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        .pengangkutan { 
            background: linear-gradient(135deg, #ec4899, #be185d);
            color: white;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
        }
        .default { 
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
        }
        
        .search-container {
            position: relative;
        }
        
        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            z-index: 10;
        }
        
        .search-input {
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .back-button {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .back-button:hover {
            transform: translateX(-4px);
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            position: relative;
            overflow: hidden;
        }
        
        .profile-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        /* Floating animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Stagger animation for cards */
        .faculty-card {
            opacity: 0;
            transform: translateY(20px);
            animation: slideInUp 0.6s ease forwards;
        }
        
        @keyframes slideInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Pulse effect for count */
        .count-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Enhanced scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
        }

        /* Style for the edit modal */
        #editModal {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <audio id="backgroundMusic" loop>
        <source src="https://sirpoji.my/permata-fpp-uitmsabah/uitmdihatikuinstru.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <button id="audioControl" class="fixed bottom-5 right-5 z-50 w-12 h-12 glass rounded-full text-white flex items-center justify-center hover:bg-opacity-20 transition-all duration-300" title="Toggle Music">
        <svg id="playIcon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path d="M4.018 14.384A1 1 0 013 13.5V6.5a1 1 0 011.555-.832l6 3.5a1 1 0 010 1.664l-6 3.5a1 1 0 01-.537.152z"></path>
        </svg>
        <svg id="pauseIcon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
            <path d="M5 4h3a1 1 0 011 1v10a1 1 0 01-1 1H5a1 1 0 01-1-1V5a1 1 0 011-1zm7 0h3a1 1 0 011 1v10a1 1 0 01-1 1h-3a1 1 0 01-1-1V5a1 1 0 011-1z"></path>
        </svg>
    </button>

    <div id="app" class="min-h-screen">
        
        <div id="homepage" class="block">
            <header class="relative bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 overflow-hidden">
                <div id="authContainer" class="absolute top-4 right-4 z-20"></div>

                <div class="absolute inset-0 bg-black opacity-10"></div>
                <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1.5'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
                
                <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
                    <div class="text-center">
                        <div class="floating mb-6">
                            <div class="inline-flex items-center justify-center w-24 h-24 bg-white bg-opacity-20 rounded-full backdrop-blur-sm border border-white border-opacity-30 mb-6">
                                <img src="https://i.imgur.com/3IfJvBe.png" alt="UiTM Logo" class="w-20 h-20 object-contain">
                            </div>
                        </div>
                        <h1 class="text-5xl md:text-6xl font-bold text-white mb-4 tracking-tight">
                            Faculty <span class="text-yellow-300">Directory</span>
                        </h1>
                        <p class="text-xl text-indigo-100 max-w-2xl mx-auto leading-relaxed">
                            Discover our distinguished faculty members and explore their expertise across various academic disciplines
                        </p>
                        <div class="mt-8 flex justify-center">
                            <div class="glass px-6 py-3 rounded-full">
                                <span class="text-white font-semibold">🎓 Excellence in Education</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="absolute top-10 left-10 w-20 h-20 bg-white bg-opacity-10 rounded-full blur-xl"></div>
                <div class="absolute bottom-10 right-10 w-32 h-32 bg-pink-300 bg-opacity-20 rounded-full blur-2xl"></div>
                <div class="absolute top-1/2 left-1/4 w-16 h-16 bg-yellow-300 bg-opacity-20 rounded-full blur-lg"></div>
            </header>

            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-0">
                <div class="bg-white rounded-2xl shadow-2xl border border-gray-100 p-8 mb-8 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                    
                    <div class="flex flex-col lg:flex-row gap-6 items-center">
                        <div class="search-container flex-1">
                            <div class="search-icon">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <input 
                                type="text" 
                                id="searchInput" 
                                placeholder="🔍 Search faculty by name, position, or field..." 
                                class="search-input w-full pl-14 pr-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-20 focus:border-indigo-500 text-lg font-medium transition-all duration-300"
                            >
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-4 items-center">
                            <select id="fieldFilter" class="px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-20 focus:border-indigo-500 text-lg font-medium bg-white transition-all duration-300 min-w-[200px]">
                                <option value="">🎯 All Fields</option>
                                <option value="EKONOMI">📊 Economics</option>
                                <option value="KEWANGAN">💰 Finance</option>
                                <option value="PEMASARAN">📈 Marketing</option>
                                <option value="PENGURUSAN">👥 Management</option>
                                <option value="PENGANGKUTAN">🚛 Transportation</option>
                            </select>
                            
                            <button id="clearFilters" class="px-6 py-4 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-xl hover:from-gray-600 hover:to-gray-700 transition-all duration-300 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105">
                                Clear
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex flex-col sm:flex-row justify-between items-center">
                        <div class="text-lg text-gray-700 font-medium">
                            <span class="inline-flex items-center">
                                <span class="w-3 h-3 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                                <span id="facultyCount" class="count-pulse font-bold text-indigo-600">0</span> 
                                <span class="ml-1">faculty members found</span>
                            </span>
                        </div>
                        
                        <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                            <div class="text-sm text-gray-500">Sort by:</div>
                            <select id="sortBy" class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="name">Name</option>
                                <option value="position">Position</option>
                                <option value="field">Field</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="facultyGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    </div>
            </div>
        </div>

        <div id="profileView" class="hidden">
            </div>
    </div>

    <div id="editModal" class="hidden opacity-0 fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="modal-content bg-white rounded-2xl shadow-xl w-full max-w-lg p-8 transform scale-95">
            <h2 class="text-2xl font-bold mb-6">Edit Your Profile</h2>
            <form id="editForm">
                <input type="hidden" id="editEmail">
                <div class="mb-4">
                    <label for="editName" class="block text-gray-700 font-medium mb-2">Full Name</label>
                    <input type="text" id="editName" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label for="editPosition" class="block text-gray-700 font-medium mb-2">Position</label>
                    <input type="text" id="editPosition" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                </div>
                 <div class="mb-4">
                    <label for="editPhone" class="block text-gray-700 font-medium mb-2">Phone</label>
                    <input type="text" id="editPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                </div>
                 <div class="mb-6">
                    <label for="editImageUrl" class="block text-gray-700 font-medium mb-2">Image URL</label>
                    <input type="url" id="editImageUrl" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div class="flex justify-end gap-4">
                    <button type="button" id="closeModalBtn" class="px-6 py-2 bg-gray-200 rounded-lg font-semibold">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-semibold">Save Changes</button>
                </div>
            </form>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBw3CzBbdO49NpxkOqAmVI596nuB9wmt8w",
            authDomain: "academiq-9c9zg.firebaseapp.com",
            projectId: "academiq-9c9zg",
            storageBucket: "academiq-9c9zg.appspot.com",
            messagingSenderId: "779034912138",
            appId: "1:779034912138:web:b2bdd60d01622bf9261473",
            measurementId: "G-DGZHBZBYLW"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>
    <script>
        let facultyData = []; // This will be filled from Firestore
        let filteredFaculty = [];
        let currentUser = null; // To hold the logged-in user's state

        // ---- AUTHENTICATION LOGIC ----
        const authContainer = document.getElementById('authContainer');
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.setCustomParameters({ 'hd': 'uitm.edu.my' });

        function googleLogin() {
            auth.signInWithPopup(provider).catch(error => {
                console.error("Login failed:", error);
                alert("Login failed. Please ensure you are using a uitm.edu.my account and have enabled popups.");
            });
        }

        function logout() {
            auth.signOut();
        }

        auth.onAuthStateChanged(user => {
            if (user && user.email.endsWith('@uitm.edu.my')) {
                currentUser = user;
                authContainer.innerHTML = `
                    <div class="flex items-center gap-4">
                        <img src="${user.photoURL}" alt="User" class="w-10 h-10 rounded-full border-2 border-white">
                        <button onclick="logout()" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 transition">Logout</button>
                    </div>
                `;
            } else {
                currentUser = null;
                authContainer.innerHTML = `
                    <button onclick="googleLogin()" class="bg-white text-indigo-600 font-bold py-2 px-4 rounded-lg hover:bg-gray-100 transition">
                        Faculty Login
                    </button>
                `;
            }
            renderFacultyGrid(); 
        });

        // ---- DATA FETCHING & RENDERING LOGIC ----
        async function fetchFacultyData() {
            const facultyCollection = db.collection('faculty');
            const snapshot = await facultyCollection.orderBy('name').get(); // Sort by name by default
            facultyData = snapshot.docs.map(doc => doc.data());
            filteredFaculty = [...facultyData];
            renderFacultyGrid();
        }

        function renderFacultyGrid() {
            const grid = document.getElementById('facultyGrid');
            if (!grid) return;
            grid.innerHTML = filteredFaculty.map((faculty, index) => 
                createFacultyCard(faculty, index)
            ).join('');
            document.getElementById('facultyCount').textContent = filteredFaculty.length;
        }

        function createFacultyCard(faculty, index) {
            const initials = getInitials(faculty.name);
            const delay = (index % 12) * 0.1;
            const cardGradient = getCardGradient(index);
            const profileImage = faculty.imageUrl && faculty.imageUrl !== '#' ? faculty.imageUrl : '';
            const isOwner = currentUser && currentUser.email === faculty.email;

            const editButtonHTML = isOwner ? `
                <button onclick="event.stopPropagation(); openEditModal('${faculty.email}')" class="mt-4 w-full bg-yellow-400 text-yellow-800 px-6 py-3 rounded-xl font-bold transition-all duration-300 hover:bg-yellow-500 shadow-lg hover:shadow-xl transform hover:scale-105">
                    Edit My Profile
                </button>
            ` : '';

            return `
                <div class="faculty-card bg-gradient-to-r ${cardGradient} rounded-3xl shadow-2xl p-8 relative group overflow-hidden" 
                    onclick="window.open('${faculty.path}', '_blank')" 
                    style="animation-delay: ${delay}s;">
                    
                    <div class="absolute inset-0 bg-black opacity-10"></div>
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white bg-opacity-10 rounded-full -translate-y-16 translate-x-16"></div>
                    <div class="absolute bottom-0 left-0 w-24 h-24 bg-white bg-opacity-10 rounded-full translate-y-12 -translate-x-12"></div>
                    
                    <div class="relative z-10">
                        <div class="flex flex-col space-y-6">
                            <div class="flex items-start justify-between">
                                <div class="faculty-avatar relative">
                                    ${profileImage ? `
                                        <div class="w-24 h-24 rounded-3xl overflow-hidden backdrop-blur-sm border-4 border-white border-opacity-30 shadow-2xl">
                                            <img src="${profileImage}" alt="${faculty.name}" class="w-full h-full object-cover">
                                        </div>
                                    ` : `
                                        <div class="w-24 h-24 bg-white bg-opacity-20 rounded-3xl flex items-center justify-center text-white font-bold text-2xl backdrop-blur-sm border-4 border-white border-opacity-30 shadow-2xl">
                                            ${initials}
                                        </div>
                                    `}
                                </div>
                            </div>
                            
                            <div class="text-white">
                                <h3 class="text-2xl font-bold mb-2 leading-tight group-hover:text-yellow-200 transition-colors duration-300">
                                    ${faculty.name}
                                </h3>
                                <p class="text-lg font-medium mb-4 text-white text-opacity-90">
                                    ${faculty.position}
                                </p>
                                
                                <button class="w-full bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-6 py-3 rounded-xl font-bold transition-all duration-300 backdrop-blur-sm border border-white border-opacity-30 hover:border-opacity-50 shadow-lg hover:shadow-xl transform hover:scale-105">
                                    View Full Portfolio →
                                </button>
                                ${editButtonHTML}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ---- EDIT PROFILE MODAL LOGIC ----
        const editModal = document.getElementById('editModal');
        const editForm = document.getElementById('editForm');
        const closeModalBtn = document.getElementById('closeModalBtn');

        function openEditModal(email) {
            const member = facultyData.find(f => f.email === email);
            if (!member) return;

            document.getElementById('editEmail').value = member.email;
            document.getElementById('editName').value = member.name;
            document.getElementById('editPosition').value = member.position;
            document.getElementById('editPhone').value = member.phone;
            document.getElementById('editImageUrl').value = member.imageUrl;

            editModal.classList.remove('hidden');
            setTimeout(() => { 
                editModal.classList.remove('opacity-0');
                editModal.firstElementChild.classList.remove('scale-95');
            }, 10);
        }

        function closeEditModal() {
            editModal.classList.add('opacity-0');
            editModal.firstElementChild.classList.add('scale-95');
            setTimeout(() => editModal.classList.add('hidden'), 300);
        }

        closeModalBtn.addEventListener('click', closeEditModal);

        editForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('editEmail').value;
            const updatedData = {
                name: document.getElementById('editName').value,
                position: document.getElementById('editPosition').value,
                phone: document.getElementById('editPhone').value,
                imageUrl: document.getElementById('editImageUrl').value,
            };

            const facultyDocRef = db.collection('faculty').doc(email);
            try {
                await facultyDocRef.update(updatedData);
                alert("Profile updated successfully!");
                closeEditModal();
                fetchFacultyData();
            } catch (error) {
                console.error("Error updating document: ", error);
                alert("Failed to update profile. You may not have permission.");
            }
        });

        // ---- FILTER & SORT LOGIC ----
        function filterFaculty() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const fieldFilter = document.getElementById('fieldFilter').value;
            
            filteredFaculty = facultyData.filter(faculty => {
                const matchesSearch = faculty.name.toLowerCase().includes(searchTerm) ||
                                      faculty.position.toLowerCase().includes(searchTerm) ||
                                      faculty.field.toLowerCase().includes(searchTerm);
                const matchesField = !fieldFilter || faculty.field === fieldFilter;
                return matchesSearch && matchesField;
            });
            sortFaculty(); // Apply current sort order after filtering
        }

        function sortFaculty() {
            const sortBy = document.getElementById('sortBy').value;
            filteredFaculty.sort((a, b) => a[sortBy]?.localeCompare(b[sortBy]));
            renderFacultyGrid();
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('fieldFilter').value = '';
            document.getElementById('sortBy').value = 'name';
            filteredFaculty = [...facultyData];
            renderFacultyGrid();
        }

        // ---- UTILITY FUNCTIONS ----
        function getInitials(name) { return name.split(' ').filter(n => n).map(n => n[0]).slice(0, 2).join('').toUpperCase(); }
        function getCardGradient(index) {
            const gradients = ['from-purple-600 via-pink-500 to-red-500', 'from-blue-600 via-indigo-500 to-purple-500', 'from-green-500 via-emerald-500 to-teal-500', 'from-orange-500 via-red-500 to-pink-500'];
            return gradients[index % gradients.length];
        }

        // ---- EVENT LISTENERS & INITIALIZATION ----
        document.addEventListener('DOMContentLoaded', () => {
            fetchFacultyData();

            document.getElementById('searchInput').addEventListener('input', filterFaculty);
            document.getElementById('fieldFilter').addEventListener('change', filterFaculty);
            document.getElementById('sortBy').addEventListener('change', sortFaculty);
            document.getElementById('clearFilters').addEventListener('click', clearFilters);

            // Audio Controls...
            // ... (Your existing audio control logic)
        });

        // =================================================================================
        // == ONE-TIME DATA MIGRATION SCRIPT                                              ==
        // =================================================================================
        // This script will upload your local faculty data to Firestore.
        // It runs automatically when you open this file.
        // AFTER you confirm the data is in your Firestore console,
        // DELETE OR COMMENT OUT THE `uploadFacultyData()` function call below.
        
        const dataToUpload = [
            // The full facultyData array with short emails
            { "name": "ASSOCIATE PROFESSOR DR ROZITA@UJI MOHAMMED", "position": "ACTING RECTOR", "field": "KEWANGAN", "phone": "088 - 325151", "imageUrl": "https://i.imgur.com/AfTwVHA.png", "isRector": true, "path": "https://fpp-uitmsabah.github.io/permata/rozita.html", "email": "rozita@uitm.edu.my" },
            { "name": "PROFESOR TS. DR. IMBARINE BIN HJ BUJANG, JP", "position": "PROFESOR (VK7)", "field": "KEWANGAN", "phone": "088 - 325151", "imageUrl": "https://i.imgur.com/yK4vFQ9.png", "distinguished": true, "path": "https://fpp-uitmsabah.github.io/permata/imbarine.html", "scholarId": "PQPF3kkAAAAJ", "email": "imbarine@uitm.edu.my" },
            { "name": "ASSOCIATE PROFESSOR DR SYLVIA@ NABILA AZWA AMBAD", "position": "PROFESOR MADYA", "field": "KEUSAHAWANAN", "phone": "088 - 325151", "imageUrl": "https://i.imgur.com/R4QSvdh.png", "distinguished": true, "path": "https://fpp-uitmsabah.github.io/permata/nabila.html", "scholarId": "P0Q0iT0AAAAJ", "orcidId": "0000-0003-1693-8514", "wosId": "AAN-4346-2021", "scopusId": "57190841191", "adScientificId": "331732", "email": "sylvia@uitm.edu.my" },
            { "name": "ASSOCIATE PROFESSOR DR IMELDA ALBERT GISIP", "position": "PROFESOR MADYA", "field": "PEMASARAN", "phone": "088 - 325151", "imageUrl": "https://i.imgur.com/znk7EGc.png", "isMarketingExpert": true, "path": "https://fpp-uitmsabah.github.io/permata/imelda.html", "email": "imelda@uitm.edu.my" },
            { "name": "ASSOCIATE PROFESSOR DR ABDUL AZIZ KARIA", "position": "PROFESOR MADYA", "field": "EKONOMI", "phone": "088 - 325151", "imageUrl": "https://i.imgur.com/pIBl3hM.png", "isEconomist": true, "path": "https://fpp-uitmsabah.github.io/permata/azizkaria.html", "scholarId": "wEU9sPoAAAAJ", "email": "abdul@uitm.edu.my" },
            { "name": "ASSOCIATE PROFESSOR DR NOORZIAH MOHD SALLEH", "position": "PROFESOR MADYA", "field": "PENGURUSAN", "phone": "088 - 325151", "imageUrl": "https://i.imgur.com/YzT5qni.png", "isHumanCapitalExpert": true, "path": "https://fpp-uitmsabah.github.io/permata/noorziah.html", "orcidId": "0000-0003-0243-3443", "scholarId": "UEdCve8AAAAJ", "email": "noorziah@uitm.edu.my" },
            { "name": "DR DEWI BINTI TAJUDDIN", "position": "PENSYARAH KANAN", "field": "PENGURUSAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/dewi.html", "imageUrl": "https://i.imgur.com/KAwa8sg.png", "email": "dewi@uitm.edu.my" },
            { "name": "DR SITI RAHAYU BINTI BELI", "position": "PENSYARAH KANAN", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/rahayu.html", "imageUrl": "https://i.imgur.com/gnIUTT6.png", "email": "siti@uitm.edu.my" },
            { "name": "DR RAINAH GINSAD", "position": "PENSYARAH KANAN", "field": "EKONOMI", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/rainah.html", "imageUrl": "https://i.imgur.com/wY54IiY.png", "scholarId": "DTVW8oMAAAAJ", "email": "rainah@uitm.edu.my" },
            { "name": "DR JASMINE VIVIENNE ANDREW", "position": "PENSYARAH KANAN", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/jasmine.html", "imageUrl": "https://i.imgur.com/RPrDp9X.png", "email": "jasmine@uitm.edu.my" },
            { "name": "DR SARMILA UDIN", "position": "PENSYARAH KANAN", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/sarmila.html", "imageUrl": "https://i.imgur.com/hH2M9wI.png", "email": "sarmila@uitm.edu.my" },
            { "name": "DR FLICIA RIMIN", "position": "PENSYARAH KANAN", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/flicia.html", "imageUrl": "https://i.imgur.com/Lt3PoS4.png", "email": "flicia@uitm.edu.my" },
            { "name": "DR RAPHEEDAH MUSNEH", "position": "PENSYARAH KANAN", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/rapheedah.html", "imageUrl": "https://i.imgur.com/4AU1ScM.png", "email": "rapheedah@uitm.edu.my" },
            { "name": "DR SHARIFAH NURAFIZAH SYED ANNUAR", "position": "PENSYARAH KANAN", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/sharifah.html", "imageUrl": "https://i.imgur.com/mZx1OJe.png", "email": "sharifah@uitm.edu.my" },
            { "name": "DR ABDUL AZIZ LAI MOHD FIKRI LAI", "position": "PENSYARAH KANAN", "field": "KEWANGAN", "phone": "088 - 325213", "path": "https://fpp-uitmsabah.github.io/permata/azizlai.html", "imageUrl": "https://i.imgur.com/6Fx6Uc8.jpeg", "email": "abdul@uitm.edu.my" },
            { "name": "AHMAD FAUZE ABDUL HAMIT", "position": "PENSYARAH", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/fauze.html", "imageUrl": "https://i.imgur.com/wvOF6kd.jpeg", "scholarId": "eJvlXzIAAAAJ", "orcidId": "0000-0002-4343-6037", "wosId": "JVD-7667-2023", "email": "ahmad@uitm.edu.my" },
            { "name": "AHMAD GHAZALI BIN ISMAIL", "position": "PENSYARAH", "field": "EKONOMI", "phone": "088 - 513867", "path": "https://fpp-uitmsabah.github.io/permata/ghazali.html", "imageUrl": "https://i.imgur.com/6vXlmtW.jpeg", "email": "ahmad@uitm.edu.my" },
            { "name": "ANASTASIAH BINTI HARBI", "position": "PENSYARAH", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/anastasia.html", "imageUrl": "https://i.imgur.com/AAs2gaX.jpeg", "email": "anastasiah@uitm.edu.my" },
            { "name": "DR CYNTHIA @ ANNAMARIA ROBERT DAWAYAN", "position": "PENSYARAH KANAN", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/cynthia.html", "imageUrl": "https://i.imgur.com/n748h8z.png", "email": "cynthia@uitm.edu.my" },
            { "name": "CYRIL SUPAIN @ CHRISTOPHER", "position": "PENSYARAH KANAN", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/cyril.html", "imageUrl": "https://i.imgur.com/aBd1Bme.jpeg", "email": "cyril@uitm.edu.my" },
            { "name": "DR DAYANG HARYANI DIANA BT AG DAMIT", "position": "PENSYARAH KANAN", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/dayang.html", "imageUrl": "https://i.imgur.com/Q66orWt.jpeg", "email": "dayang@uitm.edu.my" },
            { "name": "DG KAMISAH BINTI AG BUDIN", "position": "PENSYARAH KANAN", "field": "PENGURUSAN SUMBER MANUSIA", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/dgkamisah.html", "imageUrl": "https://i.imgur.com/LLv1xol.jpeg", "email": "dg@uitm.edu.my" },
            { "name": "DGKU ALMAHIRAH AWANG KEE", "position": "PENSYARAH", "field": "PENGURUSAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/dgkualmahirah.html", "imageUrl": "#", "email": "dgku@uitm.edu.my" },
            { "name": "FAIQAH BINTI MAWARDI", "position": "PENSYARAH KANAN", "field": "PENGURUSAN OPERASI", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/faiqah.html", "imageUrl": "https://i.imgur.com/IojOXXu.jpeg", "email": "faiqah@uitm.edu.my" },
            { "name": "FARIDAH BINTI MOHD SHAH", "position": "PENSYARAH", "field": "PENGURUSAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/faridah.html", "imageUrl": "https://i.imgur.com/9kyxtX1.jpeg", "email": "faridah@uitm.edu.my" },
            { "name": "FRANKLIN HAZLEY LAI", "position": "PENSYARAH KANAN", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/franklin.html", "imageUrl": "https://i.imgur.com/FUaqmnE.jpeg", "email": "franklin@uitm.edu.my" },
            { "name": "DR HASNAWATI HAJI GULILING", "position": "PENSYARAH KANAN", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/hasnawati.html", "imageUrl": "https://i.imgur.com/YqCHyq5.jpeg", "email": "hasnawati@uitm.edu.my" },
            { "name": "HERNIZA ROXANNE MARCUS", "position": "PENSYARAH", "field": "EKONOMI", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/herniza.html", "imageUrl": "https://i.imgur.com/B2WoXT6.jpeg", "email": "herniza@uitm.edu.my" },
            { "name": "DR HYLMEE MATAHIR", "position": "PENSYARAH KANAN", "field": "EKONOMI", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/hylmee.html", "imageUrl": "https://i.imgur.com/KzSNZUc.jpeg", "email": "hylmee@uitm.edu.my" },
            { "name": "DR JAIN YASSIN", "position": "PENSYARAH KANAN", "field": "EKONOMI", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/jain.html", "imageUrl": "https://i.imgur.com/iyNGGCy.jpeg", "email": "jain@uitm.edu.my" },
            { "name": "DR JASMAN TUYON", "position": "PENSYARAH KANAN", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/jasman.html", "imageUrl": "https://i.imgur.com/4u4oIcY.jpeg", "email": "jasman@uitm.edu.my" },
            { "name": "KAMARULZAMAN B ISHAK", "position": "PENSYARAH KANAN", "field": "PENGANGKUTAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/kamarulzaman.html", "imageUrl": "https://i.imgur.com/ojqbTPz.jpeg", "email": "kamarulzaman@uitm.edu.my" },
            { "name": "DR JACQUELINE KOH SIEW LEN BTE STEPHEN", "position": "PENSYARAH KANAN", "field": "PENGURUSAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/jacqueline.html", "imageUrl": "https://i.imgur.com/jeP92pB.jpeg", "email": "jacqueline@uitm.edu.my" },
            { "name": "KHAIRIAH MAZDIAH BINTI KALIMIN", "position": "PENSYARAH", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/khairiah.html", "imageUrl": "https://i.imgur.com/ISFXj5V.jpeg", "email": "khairiah@uitm.edu.my" },
            { "name": "MARYAM QAAMEELAH OTHMAN", "position": "PENSYARAH", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/maryam.html", "imageUrl": "https://i.imgur.com/cwzclWd.jpeg", "email": "maryam@uitm.edu.my" },
            { "name": "MOHAMAD ZULFADHLI BIN JUSOH", "position": "PENSYARAH", "field": "PENGANGKUTAN", "phone": "088 - 951611", "path": "https://fpp-uitmsabah.github.io/permata/zulfadhli.html", "imageUrl": "https://i.imgur.com/UNWImiZ.jpeg", "email": "mohamad@uitm.edu.my" },
            { "name": "MOHAMMAD FIRDAUS BIN MOHAMAD", "position": "PENSYARAH KANAN", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/firdaus.html", "imageUrl": "https://i.imgur.com/T2BGkeh.jpeg", "email": "mohammad@uitm.edu.my" },
            { "name": "DR MAILY PATRICK", "position": "PENSYARAH KANAN", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/maily.html", "imageUrl": "https://i.imgur.com/KFn1sic.jpeg", "email": "maily@uitm.edu.my" },
            { "name": "DR MOHD ADZWIN FARIS NIASIN", "position": "PENSYARAH KANAN", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/adzwin.html", "imageUrl": "https://i.imgur.com/fpzCzj9.jpeg", "email": "mohd@uitm.edu.my" },
            { "name": "MYDAH @ MYLENDA ERIC", "position": "PENSYARAH KANAN", "field": "PENGURUSAN OPERASI", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/mydah.html", "imageUrl": "#", "email": "mydah@uitm.edu.my" },
            { "name": "NINALYN FRIDRICT", "position": "PENSYARAH", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/ninalyn.html", "imageUrl": "https://i.imgur.com/j8qifBN.jpeg", "email": "ninalyn@uitm.edu.my" },
            { "name": "NURUL HIDAYAH MAT NOR", "position": "PENSYARAH KANAN", "field": "EKONOMI", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/hidayah.html", "imageUrl": "#", "email": "nurul@uitm.edu.my" },
            { "name": "NUR HAZILAH OMAR", "position": "PENSYARAH", "field": "PENGURUSAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/hazilah.html", "imageUrl": "https://i.imgur.com/LSw0Z0g.jpeg", "email": "nur@uitm.edu.my" },
            { "name": "DR PG. MOHD AUZA'E BIN PG ARSHAD", "position": "PENSYARAH KANAN", "field": "PENGURUSAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/auzae.html", "imageUrl": "https://i.imgur.com/ylpeVSG.jpeg", "email": "pg@uitm.edu.my" },
            { "name": "DR NORNAJIHAH NADIA HASBULLAH", "position": "PENSYARAH KANAN", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/nornajihah.html", "imageUrl": "https://i.imgur.com/4v3GwBm.jpeg", "scholarId": "ypjhvzcAAAAJ", "orcidId": "0000-0002-6097-9981", "wosId": "AFI-9812-2022", "scopusId": "57216148170", "googleDriveLink": "https://drive.google.com/open?id=1h_Z56SST-31mgOqKOWgD4M490PGrsY3p", "email": "nornajihah@uitm.edu.my" },
            { "name": "DR MOHD RAZUAN BIN ABD HISHAMUDDIN", "position": "PENSYARAH KANAN", "field": "KEWANGAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/razuan.html", "imageUrl": "https://i.imgur.com/pYidT6V.jpeg", "email": "mohd@uitm.edu.my" },
            { "name": "DR TAUFIK ABD HAKIM", "position": "PENSYARAH KANAN", "field": "EKONOMI", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/taufik.html", "imageUrl": "https://i.imgur.com/8m4ozuO.jpeg", "email": "taufik@uitm.edu.my" },
            { "name": "MOHD ROZIE MOHD DAMIT", "position": "PENSYARAH KANAN", "field": "KEWANGAN", "phone": "088 - 325151", "imageUrl": "https://i.imgur.com/BHVplSw.png", "path": "https://fpp-uitmsabah.github.io/permata/rozie.html", "email": "mohd@uitm.edu.my" },
            { "name": "SITI JULEA BINTI SUPAR", "position": "PENSYARAH", "field": "KEWANGAN", "phone": "088 - 325219", "path": "https://fpp-uitmsabah.github.io/permata/sitijulea.html", "imageUrl": "https://i.imgur.com/T9WUIx4.jpeg", "email": "siti@uitm.edu.my" },
            { "name": "SUMAFFIATIE SULONG", "position": "PENSYARAH KANAN", "field": "EKONOMI", "phone": "088 - 325219", "path": "https://fpp-uitmsabah.github.io/permata/sumaffiatie.html", "imageUrl": "https://i.imgur.com/4jYnFqX.jpeg", "email": "sumaffiatie@uitm.edu.my" },
            { "name": "NUR SHAHAFIQAH NADIAH BINTI JAFFERY", "position": "PENSYARAH", "field": "PEMASARAN", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/nurshahafiqah.html", "imageUrl": "https://i.imgur.com/w5Qc4D5.jpeg", "email": "nur@uitm.edu.my" },
            { "name": "HJ. S. JUNAIDI BIN MOHAMMAD", "position": "PENSYARAH KANAN", "field": "EKONOMI", "phone": "088 - 325151", "path": "https://fpp-uitmsabah.github.io/permata/junaidi.html", "imageUrl": "#", "email": "junaidi@uitm.edu.my" },
            { "name": "SUALI @ SUHAILIE BAKRIN", "position": "PENSYARAH", "field": "PENGURUSAN", "phone": "088 - 513870", "path": "https://fpp-uitmsabah.github.io/permata/suali.html", "imageUrl": "https://i.imgur.com/yHMd3b4.jpeg", "email": "suali@uitm.edu.my" },
            { "name": "MELINDA AZZALEA TAI ABDULLAH @ TAI NYUK CHIN", "position": "PENSYARAH", "field": "EKONOMI", "phone": "088 - 325102", "path": "https://fpp-uitmsabah.github.io/permata/melinda.html", "imageUrl": "https://i.imgur.com/f5olmQB.jpeg", "email": "melinda@uitm.edu.my" }
        ];

        async function uploadFacultyData() {
            const facultyCollection = db.collection('faculty');
            
            console.log("Starting one-time data migration to Firestore...");
            let count = 0;
            const batch = db.batch(); // Use a batch for efficient writing

            for (const member of dataToUpload) {
                if (member.email) {
                    const docRef = facultyCollection.doc(member.email); // Use email as the document ID
                    batch.set(docRef, member);
                    count++;
                }
            }
            
            try {
                await batch.commit();
                console.log(`Successfully uploaded ${count} faculty members.`);
                alert(`Successfully migrated ${count} faculty members to Firestore.`);
            } catch (error) {
                console.error("Error during data migration: ", error);
                alert("An error occurred during data migration. Check the console for details.");
            }
        }

        // =================================================================================
        // == IMPORTANT! REMOVE OR COMMENT OUT THIS LINE AFTER FIRST SUCCESSFUL UPLOAD    ==
        // =================================================================================
        uploadFacultyData();
        // =================================================================================

    </script>
</body>
</html>
